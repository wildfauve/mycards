<% head_date_data = @card.date_made.strftime('%s')  %> 

//clear errors just in case
$('#new-status').empty();

//Create a header to place the card item under
var header = $(".cd-date-hdr[data-date='<%= head_date_data%>']");
if (header.length == 0) {
	<% card = @card %>
	var hdr_content = $("<%= escape_javascript(render(:partial => "cards/list_header", :locals => {:card => card} )) %>");
	if ( $('.cd-date-hdr').size() == 0 ) {
		$('.cd-list').append(hdr_content);
	}
	// data. representation of the data- attr
	if ( parseInt( $('.cd-date-hdr:last').data('date') ) > <%= head_date_data %> ) {
		$('.cd-list-item:last').after(function(index) {
			$(this).after(hdr_content);
		});
	}
	else {
		$('.cd-date-hdr').each(function(index) {
			if ( parseInt( $(this).data('date') ) < <%= head_date_data %> )	{
				$(this).before(hdr_content);
				return false;
			}
		});		
	}
}

// There now should always be a header to append to
var item = $("<%= escape_javascript(render(:partial => 'list_detail', :locals => {:head_date_data => head_date_data})) %>");
item.addClass('new-list-item');
var header = $(".cd-date-hdr[data-date='<%= head_date_data%>']");
header.after(function(index) {
	item.addClass('new-list-item');
	$(this).after(item)
	item.slideDown('slow')
			.removeClass('new-list-item');
	var newnum = $(".cd-list-item[data-date='<%= head_date_data%>']").size();
	var currentnum = $(this).find('span').text();
	$(this).find('span').text(newnum);
//	alert("newnum: " + newnum + "curr" + currentnum + "Length: " + $(this).length ); 
});

// now, RESET the form
$('#card_card_tags').tokenInput('clear');
$('form').get(1).reset();

// get a new cloud tag list
window.populateTagCloud();

window.getCardCounters();